<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <!-- Head -->
  <div th:replace="fragments/head :: head"></div>

  <body>
    <!-- Navbar -->
    <div th:replace="fragments/navbar :: navbar"></div>

    <!-- Alerts -->
    <div
      th:if="${exito != null}"
      class="alert alert-success alert-dismissible fade show alert-floating"
      role="alert"
    >
      <i class="bi bi-check-circle-fill me-2"></i>
      <strong>¡Éxito!</strong>
      <p class="mb-0 mt-1" th:text="${exito}"></p>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div
      th:if="${error != null}"
      class="alert alert-danger alert-dismissible fade show alert-floating"
      role="alert"
    >
      <i class="bi bi-exclamation-triangle-fill me-2"></i>
      <strong>¡Error!</strong>
      <p class="mb-0 mt-1" th:text="${error}"></p>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!-- Carousel -->
    <div class="container">
      <div id="carouselExample" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-indicators">
          <button
            type="button"
            data-bs-target="#carouselExample"
            data-bs-slide-to="0"
            class="active"
          ></button>
          <button
            type="button"
            data-bs-target="#carouselExample"
            data-bs-slide-to="1"
          ></button>
          <button
            type="button"
            data-bs-target="#carouselExample"
            data-bs-slide-to="2"
          ></button>
        </div>
        <div class="carousel-inner">
          <div class="carousel-item active">
            <img
              src="/img/alcancia_carousel.jpeg"
              class="d-block w-100"
              alt="Despensa La Alcancía"
            />
          </div>
          <div class="carousel-item">
            <img
              src="/img/superofertacartel.jpeg"
              class="d-block w-100"
              alt="Super Ofertas"
            />
          </div>
          <div class="carousel-item">
            <img
              src="/img/carousel7.jpg"
              class="d-block w-100"
              alt="Productos"
            />
          </div>
        </div>
        <button
          class="carousel-control-prev"
          type="button"
          data-bs-target="#carouselExample"
          data-bs-slide="prev"
        >
          <span class="carousel-control-prev-icon"></span>
          <span class="visually-hidden">Anterior</span>
        </button>
        <button
          class="carousel-control-next"
          type="button"
          data-bs-target="#carouselExample"
          data-bs-slide="next"
        >
          <span class="carousel-control-next-icon"></span>
          <span class="visually-hidden">Siguiente</span>
        </button>
      </div>
    </div>

    <!-- Productos Section -->
    <section class="py-5">
      <div class="container">
        <h2 class="section-title">Nuestros Productos</h2>
        <div
          class="row row-cols-1 row-cols-md-2 row-cols-lg-3 row-cols-xl-4 g-4"
        >
          <div class="col" th:each="producto : ${productos}">
            <div class="card product-card h-100">
              <div class="product-img-wrapper">
                <img
                  th:src="@{/producto/imagen/__${producto.idProducto}__}"
                  alt="imagen-producto"
                  class="card-img-top product-img"
                />
                <div class="product-overlay">
                  <i class="bi bi-zoom-in"></i>
                </div>
              </div>
              <div class="card-body text-center">
                <p class="product-name" th:text="${producto.nombre}"></p>
                <h5
                  class="product-price"
                  th:text="'$' + ${producto.precio}"
                ></h5>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Paginación -->
    <div th:if="${pageable.totalPages > 1}" class="container mb-5">
      <nav>
        <ul class="pagination">
          <li th:if="${not pageable.first}" class="page-item">
            <a class="page-link" th:href="@{/(page=0, size=${pageable.size})}">
              <i class="bi bi-chevron-double-left"></i>
            </a>
          </li>
          <li th:if="${pageable.hasPrevious}" class="page-item">
            <a
              class="page-link"
              th:href="@{/(page=${pageable.previousPageable.pageNumber}, size=${pageable.size})}"
            >
              <i class="bi bi-chevron-left"></i>
            </a>
          </li>
          <li
            th:each="pageNumber : ${#numbers.sequence(0, pageable.totalPages - 1)}"
            class="page-item"
            th:classappend="${pageNumber == pageable.number} ? 'active' : ''"
          >
            <a
              class="page-link"
              th:href="@{/(page=${pageNumber}, size=${pageable.size})}"
              th:text="${pageNumber + 1}"
            ></a>
          </li>
          <li th:if="${pageable.hasNext}" class="page-item">
            <a
              class="page-link"
              th:href="@{/(page=${pageable.nextPageable.pageNumber}, size=${pageable.size})}"
            >
              <i class="bi bi-chevron-right"></i>
            </a>
          </li>
          <li th:if="${not pageable.last}" class="page-item">
            <a
              class="page-link"
              th:href="@{/(page=${pageable.totalPages - 1}, size=${pageable.size})}"
            >
              <i class="bi bi-chevron-double-right"></i>
            </a>
          </li>
        </ul>
      </nav>
    </div>

    <!-- WhatsApp Float -->
    <a
      href="https://api.whatsapp.com/send?phone=543794862502&text=Hola%20desde%20mi%20sitio%20web"
      target="_blank"
      class="whatsapp-float"
      title="Contactanos por WhatsApp"
    >
      <img th:src="@{/img/whatsap.png}" alt="WhatsApp" />
    </a>

    <!-- Scroll to Top Button -->
    <button
      class="btn-scroll-top"
      id="backToTop"
      onclick="window.scrollTo({top: 0, behavior: 'smooth'})"
    >
      <i class="bi bi-arrow-up fs-5"></i>
    </button>

    <!-- Modal para ampliar imágenes -->
    <div class="modal fade" id="imageModal" tabindex="-1">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="bi bi-image me-2"></i>Imagen del Producto
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body p-0">
            <img id="modalImage" src="" alt="Imagen Ampliada" class="w-100" />
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div th:replace="fragments/footer :: footer"></div>

    <!-- Scripts -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script th:src="@{/js/script.js}"></script>
    <script>
      // Modal para ampliar imágenes
      document.querySelectorAll(".product-img").forEach((img) => {
        img.addEventListener("click", function () {
          const imgSrc = this.getAttribute("src");
          document.getElementById("modalImage").setAttribute("src", imgSrc);
          const modal = new bootstrap.Modal(
            document.getElementById("imageModal")
          );
          modal.show();
        });
      });

      // Scroll to top button
      window.addEventListener("scroll", function () {
        const backToTop = document.getElementById("backToTop");
        if (window.pageYOffset > 300) {
          backToTop.style.display = "flex";
        } else {
          backToTop.style.display = "none";
        }
      });

      // Auto-dismiss alerts después de 5 segundos
      setTimeout(() => {
        const alerts = document.querySelectorAll(".alert-floating");
        alerts.forEach((alert) => {
          const bsAlert = new bootstrap.Alert(alert);
          bsAlert.close();
        });
      }, 5000);
    </script>
  </body>
</html>
